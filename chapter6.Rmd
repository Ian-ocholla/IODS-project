

Wide data has a column for each variable whereas long format data has a column for possible variable type & a column for the values of those variables

1. Plot the BPRS values for all 40 men, differentiating between the treatment groups into which the mean have been randomized- Fig 8.1: BPRS score of almost the men is decreasing over the eight weeks of the study. secondly, the men who have higher BPRS values at the beginning tend to have higher values throughout the study.-This phenomenon is referred to as tracking. Thrid, there are substabtial individualdifferences and variability appears to decrease with time.

## Chapter 8
Graphical display of Longitudinal data

graphical displays are useful for exposing patterns in the data
Display the data in table format
glimpse(RATSL)









Figure 8.6: plot boxplot without the outlier- is there evidence of a difference in location of the summary measure distributions in each group.

#require a formal test for a difference between the three groups
#apply a t-test to assess any difference between the groups and also calculate a condifence interval for this difference.

#use the data without the outlier (fig 8.5) to generate Table 8.3
Does the t-test confirms the lack of any evidence for a group difference
what is the range of CI, does it include zero.

#Incoporating pre-weight outcome values into the summary measure approach

#analysis of covariance
Weight taken prior to start of the program as baseline covariate

#Table 8.4. Anlaysis of covariance of the RATS datawith baseline RATS and Groups as covariates

Is the baseline strongly related to the rats weight taken after program started


#dealing with missing values when using summary measure approach

#table 8.5. 




# Chapter 8
```{r}
# libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(lme4)

```

## Load the data and check the variables and structure
```{r}
#set working directory
setwd("C:/LocalData/ocholla/IODS-project/Data")

RATS<- read.table("Rats.txt", header = TRUE, sep = '\t')

#convert variables ID and Group to factors
RATS<- within(RATS, {
  ID<- factor(ID)
  Group<- factor(Group)
})

#Convert data to long form
RATSL<- RATS%>% 
  gather(key = WD, value = Weight, -ID, -Group) %>% 
  #mutate a new variable Time by extracting the number of the day from WD
  mutate(Time = as.integer(substr(WD,3,4)))
glimpse(RATSL)
head(RATSL)
tail(RATSL)

```


# Figure 8.1 
#Draw the plot
#* plot the RATSL values for all 11 rats mean, differentiating between the  nutrition groups into which the rats have been randomized

```{r}
ggplot(RATSL, aes(x=Time, y= Weight, linetype = WD))+
  geom_line()+
  scale_linetype_manual(values = rep(1:10,
                                     times=4))+
  facet_grid(.~ Group, labeller = label_both)+
  theme(legend.position = "none")+
  scale_y_continuous(limits = c(min(RATSL$Weight),
                                max(RATSL$Weight)))

```

solution: weights score varied within the groups across the 9 weeks.
Rats in group 2 had the highest weight maintain throughout the period
In group 3: the weights tend to increase as period increased
In group 1: the weight ws relatively maintained across the period


#task 2: standardize values of each observation
i.e. value obtained by subtracting the relevant occassion mean from the original observation and then dividing by the corresponding standard deviation


```{r}
#standardise the variables weights
RATSL<- RATSL %>%
  group_by(Time) %>% 
  mutate(stdWeight = (Weight - mean(Weight))/ sd(Weight) ) %>% 
  ungroup()

#glimpse the data
glimpse(RATSL)


```


#Figure 8.2: plotting the mean profiles as side by side plots of the observation at diff time (Time aganist standardize weights)

```{r}
#plot again with the standardized weights

ggplot(RATSL, aes(x = Time, y = stdWeight,
                  linetype = WD))+
  geom_line()+
  scale_linetype_manual(values = rep(1:10,
                                     times = 4))+
  facet_grid(. ~Group, labeller = label_both)+ scale_y_continuous(name = "standardized Weights")

```

solution: the mean of group 2 and group 3 at 1 suggests a small difference between the two groups compared to group 1 whose mean is -1.


#Figure 8.3: 
mean response profiles for the two treatment groups in Rats data (plot of time against mean(weight)+/- se(weight))
```{r}
#number of subjects (days), baseline (week 0) included
n<- 16

#summary data with mean and standard error of bprs by treatment and week
RATSS<- RATSL %>%
  group_by(Group, Time) %>% 
  summarise(mean = mean(Weight), se = sd(Weight)/sqrt(n)) %>%
  ungroup()
#Glimpse the data
glimpse(RATSS)

```


```{r}
#plot the mean profiles
ggplot(RATSS, aes(x= Time, y= mean, linetype = Group, shape = Group))+
  geom_line()+
  scale_linetype_manual(values = c(1,2,3))+
  geom_point(size =3)+ #change from 3 to 2
  scale_shape_manual(values = c(1,2,3))+
  geom_errorbar(aes(ymin= mean -se, ymax= mean + se,
                    linetype ="1"), width= 0.3)+
  theme(legend.position = c(0.8,0.8))+
  scale_y_continuous(name = "mean(Weight)+/- se(Weight)")

```


#Figure 8.4: boxplot time aganist weight 
check if there are outliers in the weights across the time period

```{r}
ggplot(RATSL, aes(x= factor(Time), y = Weight, 
                  fill = Group))+
  geom_boxplot(position = position_dodge(width = 0.9))+
  theme_bw()+theme(panel.grid.major = element_blank(), 
                   panel.grid.minor = element_blank())+
  theme(legend.position = "bottom")+ #c(0.8,0.8)
  scale_x_discrete(name = "Time")

```

#summary measure approach applied to the post weight of rats
 




```{r}
#Find the outlaw ...Outlier

#create a summary data by Group and WD with mean as the summary variable
RATSL8S<- RATSL %>%
  filter(Time > 1 ) %>% #change from 0 to 1 as 1 is the baseline date
  group_by(Group, WD) %>%
  summarise( mean = mean(Weight) )%>%
  ungroup()
#glimpse the data
glimpse(RATSL8S)

```

#task 6: calculate the measure and then look at boxplots of the measure for each group
(Figure 8.5)- boxplot of group against mean(weight), Time(8-64)

```{r}
#draw  a boxplot of the mean versus Group
ggplot(RATSL8S, aes(x = Group, y =mean)) +
  geom_boxplot()+
  stat_summary(fun.y = "mean", geom = "point", shape = 23, size =4, 
               fill = "blue")+
  scale_y_continuous(name = "mean(Weight), Time 8-64")

```

soln: indicates the mean summary measure- which one is skewed? which one has outlier
Decide weight score should be removed?
The mean summary measure is more variable in the second treatment group and its 
distribution in this group is somewaht skew
The boxplot of the second groups reveals an outlier, a subject whose BPRS score 
is the eight weeks is over 70. May cause bias conclusions for further compariosn of the groups

#No outliers so no figure 8.6

#Table 8.3

```{r}
# This is a so-called "R chunk" where you can write R code.

date()

```

```{r}
# This is a so-called "R chunk" where you can write R code.

date()

```

```{r}
# This is a so-called "R chunk" where you can write R code.

date()

```




#Chapter 9: Analysis of Longitudinal Data II: Linear Mixed Effects Models for Normal Response Variables

## fitting the independence model to the BPR data














#fit a random intercept and slope model that allows  treatment group x week interaction



#find the fitted values from the interaction model and plot the fitted growth rates for each rat
#Figure 9.4 observed vs fitted plots


Table 9.1 BPR treatment recorded over xyz period
```{r}
#set working directory
setwd("C:/LocalData/ocholla/IODS-project/Data")
#Load the data sets (BPRS)
BPRS<- read.table("BPRS.txt", sep= " ", header = TRUE)
#convert subject and treatment from integer to factors
BPRS<- within(BPRS, {
  treatment<- factor(treatment)
  subject<- factor(subject)
})

#Add column on the number of count of men 
BPRS$ID<- seq.int(nrow(BPRS))
glimpse(BPRS)


```

Table 9.2 conversion of data to long form

```{r}
#Convert the data to long form
BPRSL<- gather(BPRS, key = weeks, value = bprs, week0:week8) %>%
  #extract the week number- adding the variable week into the dataset
  mutate(week = as.integer(substr(weeks, 5, 5)))
#take a glimpse at the BPRSL data
glimpse(BPRSL)
head(BPRSL);tail(BPRSL)

```

# Figure 9.1 plot the data, identifying the observation in each group but ignoring the longitudinal nature
```{r}
ggplot(BPRSL, aes(x = week, y = bprs, group = ID))+
  geom_text(aes(label = treatment))+
  #geom_line(aes(linetype = subject))+
  scale_x_continuous(name = "Week (number)", breaks = seq(0,8,1))+
  scale_y_continuous(name = "bprs ()") + 
  theme_bw()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = 
          element_blank())

```
Figure 9.1 
Is there a difference between the bprs of treatment 1 and treatment 2


# Table 9.3
# beigin formal analysis of the weight data
1. fit the random intercept model and include the two explanatory variables: week and  treatment
- model allows the linear regresion fit for each man to differ in intercept from men
```{r}
#create a regression model RATS_reg
BPRS_reg<- lm(bprs ~ week + treatment, data = BPRSL)
#summary 
summary(BPRS_reg)

```

#fitting Linear Mixed Models to the bprs data

Figure 9.2: graphical display of the bprs data takes into account the longitudinal structure of the data by joining together the weights belonging to each man to show the bprs growth profilesof individuals men
# Figure 9.2 
```{r}
#figure 9.2
ggplot(BPRSL, aes(x= week, y = bprs, group= ID))+ #subject
  geom_line(aes(linetype= treatment))+
  scale_x_continuous(name= "Weeks (number)", breaks = seq(0,8,1))+
  scale_y_continuous(name = "bprs")+
  theme_bw()+ theme(legend.position = "top")+
  theme(panel.grid.major = element_blank(), panel.grid.minor = 
          element_blank())

```


#Figure 9.3 scatterplot matrix of repeated measure in subject treatment data

```{r}
pairs(BPRS[, 3:11], cex = 0.7)

```
Figure 9.3: scatterplot matrix of the repeated meaures of bprs
does the repeated measured are certainly not independent of one another.


#Table 9.4
```{r}
#create a random intercept model
# ID need to be similar as subject
#varied ID with Subject
BPRS_ref<- lmer(bprs ~ week + treatment + (1 | ID), data =  BPRSL, REML = FALSE)

#print the summary of the model
summary(BPRS_ref)

```

#Table 9.4 : results of the regresion model
Is the estimated variance of the man random effects quite large or small?
if large- it indicates the considerable variation in the intercept of the regression fits of the individual subject treatment profile
-check if the estimated error of week is smaller in table 9.4 than it is in table 9.3

#Table 9.5 result from fitting the random intercept and slope model to the man treatment data
```{r}
BPRS_ref1<- lmer(bprs ~ week + treatment + (week|ID), data = BPRSL, REML = FALSE)
#print a summary of the model
summary(BPRS_ref1)

#perform an ANOVA test on the two models
anova(BPRS_ref1,BPRS_ref)

```
check the fixed effects, likeliood ratio test, chi-squared statistics and degree of freedom and the associated p-value (big or very small?)



## Table 9.6
```{r}
#create a random intercept and random slope model
BPRS_ref2<- lmer(bprs ~ week * treatment + (week|ID),
                 data = BPRSL, REML = FALSE)

#print a summary of the model
summary(BPRS_ref2)

#perform an ANOVA test on the two models
anova(BPRS_ref1, BPRS_ref2)

```
#Table 9.6: table of the model results
what is the likelihood ratio test of the interaction random intercept and slope model aganist the corresponding model without interaction is... with ..DF, what is the associated p-value (big or small). Conclude if the interaction model provides a better fit for the men treatment data.
what is the estimated regression parameters for interaction indicate...between the two groups..


## Figure 9.4 

```{r}
#create a vector of the fitted values
Fitted<- fitted(BPRS_ref2)
#Create a new column fitted to RATSL
BPRSL<- BPRSL%>% 
  mutate(Fitted)

#draw the plot of RATSL
ggplot(BPRSL, aes(x = week, y = bprs, group = ID))+  #group = subject
  geom_line(aes(linetype = treatment))+ 
  #geom_line()+
  #scale_linetype_manual(values = c("solid", "dashed"))+
  #geom_point(aes(col = treatment), size = 2)+
  scale_x_continuous(name = "Week (number)", breaks = seq(0, 8,1))+
  scale_y_continuous(name = "Observed bprs ()")+
  theme_bw()+ theme(legend.position = "right")+
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())+
  ggtitle("observed")
  #theme(legend.position = "top")


#draw the plot of BPRSL
ggplot(BPRSL, aes(x = week, y= Fitted, group = ID))+
  geom_line(aes(linetype = treatment))+
  scale_x_continuous(name = "Week (number)", breaks = seq(0,8,1))+
  scale_y_continuous(name = "bprs (grams)")+
  theme_bw()+theme(legend.position = "right")+
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())+
  ggtitle("Fitted")
  

```



```{r}
# This is a so-called "R chunk" where you can write R code.

date()

```
